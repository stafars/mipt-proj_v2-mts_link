# Описание данных проекта

Этот репозиторий содержит ноутбук анализа клиентских данных и несколько подготовленных датасетов в формате CSV.  
Ниже описаны исходные файлы и новые агрегированные таблицы.

---

## 1. Исходные файлы

### 1.1. `clients.csv`

**Назначение:** справочник клиентов.

**Гранулярность:** одна строка = один клиент (компания).

**Основные поля:**

- `company_id` — уникальный идентификатор клиента (анонимизированный внутренний код).
- `sector_id` — закодированный отраслевой сектор.
- `segment` — сегмент компании (например, `Small_business`, `Business_Scale`, `Public_Large` и т.п.).
- `industry` — закодированная индустрия.
- `company_size` — численность сотрудников компании (nullable `Int64`).
- `revenue` — нормированная годовая выручка компании за 2023 год (nullable `Int64`).

---

### 1.2. `revenue.csv`

**Назначение:** история покупок клиентов.

**Гранулярность:** одна строка = один продукт в рамках конкретного заказа клиента.

**Основные поля:**

- `row_id` — идентификатор строки (уникальный ID записи).
- `company_id` — идентификатор клиента (связь с `clients.xlsx` по полю `company_id`).
- `sale_id` — идентификатор заказа (в одном заказе может быть несколько продуктов / строк).
- `sale_date` — дата и время покупки (тип `datetime` после предобработки).
- `product_name` — название купленного продукта (например, `Расширения`, `Enterprise-100`, тарифы и т.п.).
- `product_sum` — стоимость лицензии продукта в данной строке заказа (nullable `Int64`).
- `sale_type` — тип покупки (`Новая`, `Продление` и т.д.).
- `product_duration` — срок действия купленной лицензии в месяцах (nullable `Int64`).


## 2. Новые агрегированные CSV-файлы
### `revenue-by-sale-date.csv`
**Добавленны временные признаки (на основе `sale_date`):**

- `sale_year` — год покупки (целое число).
- `sale_month` — месяц покупки (1–12).
- `sale_day` — день месяца.
- `sale_quarter` — квартал (1–4).
- `sale_dayofweek` — день недели (0 = понедельник, 6 = воскресенье).
- `is_weekend` — булев признак «покупка в выходной день».
- `sale_year_month` — год-месяц в формате `YYYY-MM` (например, `2023-05`).

###  `ltv.csv`

**Назначение:** LTV (Lifetime Value) по каждому клиенту.

**Гранулярность:** одна строка = один клиент (`company_id`).

**Как считается:**

LTV определяется как **сумма всех `product_sum` по клиенту** во всей истории покупок.

**Поля:**

* `company_id` — идентификатор клиента.
* `ltv` — суммарная выручка от клиента за весь период наблюдения (nullable `Int64`).

---

### `rfm.csv`

**Назначение:** RFM-метрики для анализа поведения клиентов и сегментации.

**Гранулярность:** одна строка = один клиент (`company_id`).

Расчёт ведётся на основе таблицы `revenue.xlsx` (после приведения `sale_date` к типу `datetime`).
Датой «среза» анализа считается максимальная дата покупки в данных:


Все числовые признаки приводятся к типу `Int64` (nullable).

**Поля в `rfm.csv`:**

* `company_id` — идентификатор клиента.
* `first_purchase` — дата первой покупки клиента (`min(sale_date)`).
* `last_purchase` — дата последней покупки клиента (`max(sale_date)`).
* `customer_age_days` — количество дней, которое клиент находится в системе (от первой покупки до даты анализа).
* `recency` — количество дней с момента последней покупки до даты анализа.
* `frequency` — количество **уникальных заказов** клиента (`nunique(sale_id)`).
* `monetary` — суммарная выручка от клиента за весь период наблюдения (nullable `Int64`).


### `basket.csv`

**Назначение:** товарная матрица покупок клиентов (basket analysis) для анализа ассоциаций между продуктами.

**Гранулярность:** одна строка = один клиент (`company_id`), один столбец = один продукт (`product_name`).

Файл обычно строится как **pivot-таблица** по данным `revenue.xlsx`:

**Интерпретация:**

* Строки — клиенты.
* Столбцы (кроме `company_id`) — бинарные признаки покупок продуктов:

    * значение `1` — клиент **хотя бы раз** покупал этот продукт,
    * значение `0` — продукт ни разу не покупался этим клиентом.

**Поля в `basket.csv`:**

* `company_id` — идентификатор клиента.
* `…` — по одному столбцу на каждый уникальный `product_name` из истории покупок, значения `0/1`.

**Использование:**

* анализ ассоциативных правил (`apriori`, `association_rules`),
* поиск комбинаций продуктов («покупающие X часто покупают Y»),
* подготовка фичей для кластеризации/ML по паттернам продуктовых покупок.

---

###  `rfm-features.csv`

**Назначение:** расширенный набор признаков по клиенту, объединяющий RFM, продуктовые и временные характеристики для последующего моделирования (кластеризация, ML-модели, тестирование гипотез).

**Гранулярность:** одна строка = один клиент (`company_id`).

Файл строится на основе `rfm.csv`, `revenue.xlsx` и, при необходимости, `clients.xlsx`.

Примеры шагов построения:

**Типичные поля в `rfm-features.csv`:**

Из `rfm.csv`:

* `company_id`
* `recency`
* `frequency`
* `monetary`
* `customer_age_days`
* (возможны `first_purchase`, `last_purchase` — если оставлялись)

Продуктовые и поведенческие признаки:

* `n_products` — количество уникальных продуктов, купленных клиентом.
* Столбцы по `sale_type` (например, `Новая`, `Продление`) — количество покупок каждого типа.

**Использование:**

* кластеризация клиентов (K-means, DBSCAN и др.),
* построение моделей:

    * прогноз LTV,
    * вероятность продления / оттока,
    * propensity-to-buy для отдельных продуктов,
* проверка гипотез (например, H1/H2/H3, сформулированных для Data Scientist).



## 3. Связи между таблицами

* `clients.xlsx` ↔ `revenue.xlsx` / `ltv.csv` / `rfm.csv`
  Связь по полю `company_id`.

Это позволяет:

* соединять поведенческие метрики (LTV, RFM, временные признаки покупок) с описанием клиента
  (сегмент, отрасль, размер компании),
* строить гипотезы о влиянии размера компании, типа продуктов, сегмента и отрасли на LTV и другие метрики,
* использовать агрегированные датасеты (`ltv.csv`, `rfm.csv`) в моделях (кластеризация, прогноз churn, scoring и т.п.).


